{{- /*

SPDX-License-Identifier: APACHE-2.0
*/}}

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "docs.backend.fullname" . }}-env
  namespace: {{ include "common.names.namespace" . | quote }}
  labels: {{- include "common.labels.standard" ( dict "customLabels" .Values.commonLabels "context" $ ) | nindent 4 }}
    app.kubernetes.io/component: backend
  {{- if .Values.commonAnnotations }}
  annotations: {{- include "common.tplvalues.render" ( dict "value" .Values.commonAnnotations "context" $ ) | nindent 4 }}
  {{- end }}
data:
  AWS_S3_ENDPOINT_URL: {{ .Values.awsS3.endpointUrl | quote }}
  AWS_S3_ACCESS_KEY_ID: {{ .Values.awsS3.accessKeyId | quote }}
  AWS_S3_SECRET_ACCESS_KEY: {{ .Values.awsS3.secretAccessKey | quote }}
  AWS_STORAGE_BUCKET_NAME: {{ .Values.awsS3.storageBucketName | quote }}
  AI_FEATURE_ENABLED: {{ .Values.backend.configuration.ai.enabled | quote }}
  {{- if .Values.backend.configuration.ai.enabled }}
  AI_ALLOW_REACH_FROM: {{ .Values.backend.configuration.ai.allowReachFrom | quote }}
  AI_API_KEY: {{ .Values.backend.configuration.ai.apiKey | quote }}
  AI_BASE_URL: {{ .Values.backend.configuration.ai.baseUrl | quote }}
  AI_MODEL: {{ .Values.backend.configuration.ai.model | quote }}
  {{- end }}
  API_USERS_LIST_LIMIT: {{ .Values.auth.api.usersList.limit | quote }}
  API_USERS_LIST_THROTTLE_RATE_BURST: {{ .Values.auth.api.usersList.throttleRateBurst | quote }}
  API_USERS_LIST_THROTTLE_RATE_SUSTAINED: {{ .Values.auth.api.usersList.throttleRateSustained | quote }}
  CACHES_KEY_PREFIX: {{ .Values.yProvider.configuration.caches.keyPrefix | quote }}
  CACHES_DEFAULT_TIMEOUT: {{ .Values.yProvider.configuration.caches.defaultTimeout | quote }}
  COLLABORATION_API_URL: {{ printf "http%s://%s%s" ( ternary "s" "" .Values.ingressCollaborationApi.tls ) .Values.ingressCollaborationApi.hostname .Values.ingressCollaborationApi.path | quote }}
  COLLABORATION_SERVER_SECRET: {{ .Values.collaboration.api.secret | quote }}
  COLLABORATION_WS_URL: {{ printf "ws%s://%s%s" ( ternary "s" "" .Values.ingressCollaborationWS.tls ) .Values.ingressCollaborationWS.hostname .Values.ingressCollaborationWS.path | quote }}
  COLLABORATION_WS_NOT_CONNECTED_READY_ONLY: {{ .Values.collaboration.webSockets.notConnected.readOnly | quote }}
  CONVERSION_API_CONTENT_FIELD: {{ .Values.yProvider.configuration.conversionApi.contentField | quote }}
  CONVERSION_API_ENDPOINT: {{ .Values.yProvider.configuration.conversionApi.endpoint | quote }}
  CONVERSION_API_SECURE: {{ .Values.yProvider.configuration.conversionApi.secure | quote }}
  CONVERSION_API_TIMEOUT: {{ .Values.yProvider.configuration.conversionApi.timeout | quote }}
  CRISP_WEBSITE_ID: {{ .Values.backend.configuration.analytics.crisp.websiteId | quote }}
  # FIXME Disabled until next docs release 3.8.x, see https://github.com/suitenumerique/docs/issues/1369
  # DOCUMENT_IMAGE_MAX_SIZE: {{ int .Values.backend.configuration.document.maxSize | quote }}
  FRONTEND_CSS_URL: {{ .Values.backend.configuration.frontend.cssUrl | quote }}
  FRONTEND_HOMEPAGE_FEATURE_ENABLED: {{ .Values.backend.configuration.frontend.homepageFeatureEnabled | quote }}
  FRONTEND_THEME: {{ .Values.backend.configuration.frontend.theme | quote }}
  DB_ENGINE: {{ .Values.database.engine | quote }}
  DB_HOST: {{ .Values.database.host | quote }}
  DB_PORT: {{ .Values.database.port | quote }}
  DB_NAME: {{ .Values.database.name | quote }}
  DB_USER: {{ .Values.database.user | quote }}
  DB_PASSWORD: {{ .Values.database.password | quote }}
  DJANGO_ALLOWED_HOSTS: {{ .Values.ingress.hostname | quote }}
  DJANGO_CELERY_BROKER_URL: {{ .Values.redis.url | quote }}
  DJANGO_CELERY_BROKER_TRANSPORT_OPTIONS: {{ .Values.backend.celery.configuration.broker.transportOptions | quote }}
  DJANGO_CORS_ALLOW_ALL_ORIGINS: {{ .Values.backend.configuration.django.cors.allowAllOrigins | quote }}
  DJANGO_CORS_ALLOWED_ORIGIN_REGEXES: {{ .Values.backend.configuration.django.cors.allowedOriginRegexes | quote }}
  DJANGO_CORS_ALLOWED_ORIGINS: {{ .Values.backend.configuration.django.cors.allowedOrigins | quote }}
  DJANGO_CSRF_TRUSTED_ORIGINS: {{ include "docs.baseUrl" . | quote }}
  DJANGO_CONFIGURATION: {{ .Values.backend.configuration.django.configuration | quote }}
  DJANGO_EMAIL_BACKEND: {{ .Values.backend.configuration.django.email.backend | quote }}
  DJANGO_EMAIL_BRAND_NAME: {{ .Values.backend.configuration.django.email.brandName | quote }}
  DJANGO_EMAIL_FROM: {{ .Values.backend.configuration.django.email.from | quote }}
  DJANGO_EMAIL_HOST: {{ .Values.backend.configuration.django.email.host.name | quote }}
  DJANGO_EMAIL_HOST_PASSWORD: {{ .Values.backend.configuration.django.email.host.password | quote }}
  DJANGO_EMAIL_HOST_USER: {{ .Values.backend.configuration.django.email.host.username | quote }}
  DJANGO_EMAIL_LOGO_IMG: {{ .Values.backend.configuration.django.email.logoImg | quote }}
  DJANGO_EMAIL_PORT: {{ .Values.backend.configuration.django.email.port | quote }}
  DJANGO_EMAIL_USE_SSL: {{ .Values.backend.configuration.django.email.useSsl | quote }}
  DJANGO_EMAIL_USE_TLS: {{ .Values.backend.configuration.django.email.useTls | quote }}
  DJANGO_SERVER_TO_SERVER_API_TOKENS: {{ .Values.backend.configuration.django.serverToServerApiTokens | quote }}
  DJANGO_SECRET_KEY: {{ .Values.backend.configuration.django.secretKey | quote }}
  DJANGO_SETTINGS_MODULE: {{ .Values.backend.configuration.django.settingsModule | quote }}
  DJANGO_SUPERUSER_EMAIL: {{ .Values.backend.configuration.django.superUser.email | quote }}
  DJANGO_SUPERUSER_PASSWORD: {{ .Values.backend.configuration.django.superUser.password | quote }}
  LANGUAGE_CODE: {{ .Values.backend.configuration.languageCode | quote }}
  LOGGING_LEVEL_HANDLERS_CONSOLE: {{ .Values.backend.configuration.logging.level.handlers.console | quote }}
  LOGGING_LEVEL_LOGGERS_APP: {{ .Values.backend.configuration.logging.level.loggers.app | quote }}
  LOGGING_LEVEL_LOGGERS_ROOT: {{ .Values.backend.configuration.logging.level.loggers.root | quote }}
  LOGIN_REDIRECT_URL: {{ include "docs.baseUrl" . | quote }}
  LOGIN_REDIRECT_URL_FAILURE: {{ include "docs.baseUrl" . | quote }}
  LOGOUT_REDIRECT_URL: {{ include "docs.baseUrl" . | quote }}
  MEDIA_BASE_URL: {{ include "docs.baseUrl" . | quote }}
  NO_WEBSOCKET_CACHE_TIMEOUT: {{ .Values.collaboration.webSockets.notConnected.cacheTimeout | quote }}
  OIDC_ALLOW_DUPLICATE_EMAILS: {{ .Values.auth.oidc.allowDuplicateEmails | quote }}
  OIDC_AUTH_REQUEST_EXTRA_PARAMS: {{ .Values.auth.oidc.authRequestExtraParams | quote }}
  OIDC_CREATE_USER: {{ .Values.auth.oidc.createUser | quote }}
  OIDC_FALLBACK_TO_EMAIL_FOR_IDENTIFICATION: {{ .Values.auth.oidc.fallbackToEmailForIdentification | quote }}
  OIDC_OP_JWKS_ENDPOINT: {{ .Values.auth.oidc.openIdProvider.jwksEndpoint | quote }}
  OIDC_OP_AUTHORIZATION_ENDPOINT: {{ .Values.auth.oidc.openIdProvider.authorizationEndpoint | quote }}
  OIDC_OP_TOKEN_ENDPOINT: {{ .Values.auth.oidc.openIdProvider.tokenEndpoint | quote }}
  OIDC_OP_USER_ENDPOINT: {{ .Values.auth.oidc.openIdProvider.userEndpoint | quote }}
  OIDC_OP_LOGOUT_ENDPOINT: {{ .Values.auth.oidc.openIdProvider.logoutEndpoint | quote }}
  OIDC_REDIRECT_ALLOWED_HOSTS: {{ .Values.auth.oidc.redirect.allowedHosts | quote }}
  OIDC_REDIRECT_REQUIRE_HTTPS: {{ .Values.auth.oidc.redirect.requireHttps | quote }}
  OIDC_RP_CLIENT_ID: {{ .Values.auth.oidc.relyingParty.clientId | quote }}
  OIDC_RP_CLIENT_SECRET: {{ .Values.auth.oidc.relyingParty.clientSecret | quote }}
  OIDC_RP_SIGN_ALGO: {{ .Values.auth.oidc.relyingParty.signAlgo | quote }}
  OIDC_RP_SCOPES: {{ .Values.auth.oidc.relyingParty.scopes | quote }}
  OIDC_STORE_ID_TOKEN: {{ .Values.auth.oidc.storeIdToken | quote }}
  OIDC_USE_NONCE: {{ .Values.auth.oidc.useNonce | quote }}
  OIDC_USERINFO_FULLNAME_FIELDS: {{ .Values.auth.oidc.userInfo.fullNameField | quote }}
  OIDC_USERINFO_SHORTNAME_FIELD: {{ .Values.auth.oidc.userInfo.shortNameField | quote }}
  PYTHONPATH: "/app"
  REDIS_URL: {{ .Values.redis.url | quote }}
  SENTRY_DSN: {{ .Values.backend.configuration.sentryDsn | quote }}
  SESSION_COOKIE_AGE: {{ .Values.backend.configuration.sessionCookieAge | quote }}
  SPECTACULAR_SETTINGS_ENABLE_DJANGO_DEPLOY_CHECK: {{ .Values.backend.configuration.spectacularSettingsEnableDjangoDeployCheck | quote }}
  STORAGES_STATICFILES_BACKEND: {{ .Values.backend.configuration.django.storagesStaticFilesBackend | quote }}
  THEME_CUSTOMIZATION_CACHE_TIMEOUT: {{ .Values.backend.configuration.themeCustomization.cacheTimeout | quote }}
  THEME_CUSTOMIZATION_FILE_PATH: {{ .Values.backend.configuration.themeCustomization.filePath | quote }}
  TRASHBIN_CUTOFF_DAYS: {{ .Values.backend.configuration.trashbinCutoffDays | quote }}
  USER_OIDC_ESSENTIAL_CLAIMS: {{ .Values.auth.oidc.userEssentialClaims | quote }}
  Y_PROVIDER_API_BASE_URL: {{ printf "http://%s:443/api/" ( include "docs.yProvider.fullname" . ) | quote }}
  Y_PROVIDER_API_KEY: {{ .Values.yProvider.configuration.api.key | quote }}
